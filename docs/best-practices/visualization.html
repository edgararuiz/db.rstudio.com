<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-(Local Development)">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Databases using R – Creating Visualizations</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../site_libs/quarto-nav/headroom.min.js"></script>
  <meta name="quarto:offset" content="../">
  <script src="../site_libs/quarto-search/autocomplete.min.js"></script>
  <script src="../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../site_libs/quarto-search/quarto-search.js"></script>
  <script src="../site_libs/quarto-html/quarto.js"></script>
  <script src="../site_libs/quarto-html/popper.min.js"></script>
  <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../site_libs/quarto-html/clipboard.min.js"></script>
  <script src="../site_libs/quarto-html/anchor.min.js"></script>
  <script src="../site_libs/quarto-html/quarto-html.js"></script>
  <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
  <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/bootstrap/bootstrap-dark.min.css">
  
  <script type="text/javascript">

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-20375833-3', 'auto');

  ga('send', {
    hitType: 'pageview',
    'anonymizeIp': true,
  });
  </script>
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="navbar navbar-expand-lg navbar-light bg-light ">
    <div class="container-fluid">
  <a class="navbar-brand" href="../index.html">
    Databases using R
  </a>
      <div>
        <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;"><i class="bi"></i></a>
      </div>
      <form class="d-flex mb-0">
  <input id="quarto-search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
  </div> <!-- /container-fluid -->
</nav>
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline">Creating Visualizations</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article">
<div class="row flex-fill" id="quarto-content">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="me-lg-auto py-2 docked  overflow-scroll">
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-3 px-3">
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#gettingstarted-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Getting Started</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="gettingstarted-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../getting-started/overview.html" class="">Overview</a>
</li>
          <li class="sidebar-item">
  <a href="../getting-started/connect-to-database.html" class="">Connect to a Database</a>
</li>
          <li class="sidebar-item">
  <a href="../getting-started/database-queries.html" class="">Database Queries</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#rpackages-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">R Packages</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="rpackages-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../r-packages/odbc.html" class="">odbc</a>
</li>
          <li class="sidebar-item">
  <a href="../r-packages/DBI.html" class="">DBI</a>
</li>
          <li class="sidebar-item">
  <a href="../r-packages/dplyr.html" class="">dplyr</a>
</li>
          <li class="sidebar-item">
  <a href="../r-packages/pool.html" class="">pool</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#tooling-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Tooling</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="tooling-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../tooling/connections.html" class="">Connections Pane</a>
</li>
          <li class="sidebar-item">
  <a href="../tooling/pro-drivers.html" class="">Professional Drivers</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#bestpractices-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Best Practices</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="bestpractices-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../best-practices/drivers.html" class="">Setting up ODBC Drivers</a>
</li>
          <li class="sidebar-item">
  <a href="../best-practices/run-queries-safely.html" class="">Run Queries Safely</a>
</li>
          <li class="sidebar-item">
  <a href="../best-practices/deployment.html" class="">Securing Deployed Content</a>
</li>
          <li class="sidebar-item">
  <a href="../best-practices/managing-credentials.html" class="">Securing Credentials</a>
</li>
          <li class="sidebar-item">
  <a href="../best-practices/portable-code.html" class="">Making Scripts Portable</a>
</li>
          <li class="sidebar-item">
  <a href="../best-practices/visualization.html" class="active">Creating Visualizations</a>
</li>
          <li class="sidebar-item">
  <a href="../best-practices/select-interface.html" class="">Selecting a database interface</a>
</li>
          <li class="sidebar-item">
  <a href="../best-practices/dashboards.html" class="">Enterprise-ready dashboards</a>
</li>
          <li class="sidebar-item">
  <a href="../best-practices/schema.html" class="">Schema selection</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#databases-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Databases</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="databases-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../databases/microsoft-sql-server.html" class="">MS SQL Server</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/oracle.html" class="">Oracle</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/teradata.html" class="">Teradata</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/hive.html" class="">Hive</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/impala.html" class="">Impala</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/postgresql.html" class="">PostgreSQL</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/redshift.html" class="">Redshift</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/salesforce.html" class="">Salesforce</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/my-sql.html" class="">MySQL</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/monetdb.html" class="">MonetDB</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/sqlite.html" class="">SQLite</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/big-query.html" class="">Big Query</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/athena.html" class="">Athena</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/mongodb.html" class="">MongoDB</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/netezza.html" class="">Netezza</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/cassandra.html" class="">Cassandra</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/snowflake.html" class="">Snowflake</a>
</li>
          <li class="sidebar-item">
  <a href="../databases/other-databases.html" class="">Other Databases</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#advanced-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Advanced</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="advanced-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../advanced/backend.html" class="">DBI Backend</a>
</li>
          <li class="sidebar-item">
  <a href="../advanced/translation.html" class="">SQL Translation</a>
</li>
          <li class="sidebar-item">
  <a href="../advanced/contract.html" class="">Connection Contract</a>
</li>
          <li class="sidebar-item">
  <a href="../advanced/snippets.html" class="">Connection Snippet</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#otherresources-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Other Resources</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="otherresources-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../other-resources/media.html" class="">Media</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
  </ul>
  </div>
</nav>
  </div>
  <div id="quarto-toc-sidebar" class="col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#bar-plot" class="nav-link active" data-scroll-target="#bar-plot">Bar plot</a>
<ul class="collapse">
<li><a href="#data-transformation" class="nav-link" data-scroll-target="#data-transformation">Data transformation</a></li>
<li><a href="#plotting-results-in-r" class="nav-link" data-scroll-target="#plotting-results-in-r">Plotting results in R</a></li>
<li><a href="#transform-and-plot" class="nav-link" data-scroll-target="#transform-and-plot">Transform and plot</a></li>
</ul></li>
<li><a href="#histogram" class="nav-link" data-scroll-target="#histogram">Histogram</a>
<ul class="collapse">
<li><a href="#calculations" class="nav-link" data-scroll-target="#calculations">Calculations</a></li>
<li><a href="#using-a-helper-function" class="nav-link" data-scroll-target="#using-a-helper-function">Using a helper function</a></li>
<li><a href="#data-transformation-1" class="nav-link" data-scroll-target="#data-transformation-1">Data transformation</a></li>
<li><a href="#plotting-results-in-r-1" class="nav-link" data-scroll-target="#plotting-results-in-r-1">Plotting results in R</a></li>
<li><a href="#transform-and-plot-1" class="nav-link" data-scroll-target="#transform-and-plot-1">Transform and plot</a></li>
</ul></li>
<li><a href="#raster-plot" class="nav-link" data-scroll-target="#raster-plot">Raster Plot</a>
<ul class="collapse">
<li><a href="#data-transformation-2" class="nav-link" data-scroll-target="#data-transformation-2">Data transformation</a></li>
<li><a href="#plotting-results-in-r-2" class="nav-link" data-scroll-target="#plotting-results-in-r-2">Plotting results in R</a></li>
<li><a href="#considerations" class="nav-link" data-scroll-target="#considerations">Considerations</a></li>
</ul></li>
<li><a href="#use-an-r-package" class="nav-link" data-scroll-target="#use-an-r-package">Use an R package</a></li>
</ul>
</nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 col-xl-7 px-lg-4 pe-xxl-4 ps-xxl-0">
<main>
<header id="title-block-header">
<h1 class="title d-none d-lg-block display-7">Creating Visualizations</h1>
</header>

<p>Typically, a function that produces a plot in R performs the data crunching and the graphical rendering. For example, <code>geom_histogram()</code> calculates the bin sizes and the count per bin, and then it renders the plot. Plotting functions usually require that 100% of the data be passed to them. This is a problem when working with a database. The best approach is to move the data transformation to the database, and then use a graphing function to render the results.</p>
<p>This article has two goals:</p>
<ul>
<li><p>Demonstrate a practical implementation of the <strong>“Transform in database, plot in R”</strong> concept by showing how to visualize a categorical variable using a Bar plot, a single continuous variable using a Histogram, and two continuous variables using a Raster plot, all using data in a database</p></li>
<li><p>Introduce a technique that simplifies the use of complex formulas that are required to move the calculations of the plot to the database</p></li>
</ul>
<p>An alternative, is to use a helper R package that already implements the principles shared in this article, please see the <a href="../dbplot">dbplot page</a> for more info.</p>
<section id="bar-plot" class="level2">
<h2 class="anchored" data-anchor-id="bar-plot">Bar plot</h2>
<p>A Bar plot is intended to measure and compare categorical data. Passing the category to <code>geom_bar()</code> as <code>x</code> will automatically calculate the height of the bars based on the row count per category. Here is the code of a typical bar plot using <code>ggplot2</code>:</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-4_c1fbc1e5d7dc3079a8949a59b5ab7d82">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> flights) <span class="sc">+</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> origin), <span class="at">stat =</span> <span class="st">"count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-transformation" class="level3">
<h3 class="anchored" data-anchor-id="data-transformation">Data transformation</h3>
<p>Because <code>dplyr</code> is being used to compute the count per category inside the database, the discrete values are separated using <code>group_by()</code>, followed by <code>tally()</code> to obtain the row count per category. Lastly, <code>collect()</code> downloads the results into R:</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-6_27db72125dc0409de0f9063905bd7cb8">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"flights"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-results-in-r" class="level3">
<h3 class="anchored" data-anchor-id="plotting-results-in-r">Plotting results in R</h3>
<p>The results of the Data Transformation step can now be used in <code>ggplot2</code> to render the plot. This time, <code>geom_col()</code> is used instead of <code>geom_bar()</code> because the height of the bars have been pre-calculated by <code>dplyr</code>:</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-8_47fb098f6f7bcdae6be2495c45946a60">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> origin, <span class="at">y =</span> n)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transform-and-plot" class="level3">
<h3 class="anchored" data-anchor-id="transform-and-plot">Transform and plot</h3>
<p>The plot can be created using a single piped line of code. This is particularly useful when performing exploratory data analysis because it is easy to add or remove filters, or to change the variable that is being analyzed.</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-10_388a9788d5564687869cf0b0809e88ed">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"flights"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(origin) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> origin, <span class="at">y =</span> n)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="histogram" class="level2">
<h2 class="anchored" data-anchor-id="histogram">Histogram</h2>
<p>The histogram is intended to visualize the distribution of the values of a continuous variable. It does this by grouping the values into bins with the same range of values. In essence, a histogram converts a continuous variable to a discrete variable by splitting and placing the variable’s values into multiple bins.</p>
<section id="calculations" class="level3">
<h3 class="anchored" data-anchor-id="calculations">Calculations</h3>
<p>The following breakdown of the calculation needed to create a histogram is intended to highlight the complexity of moving its processing to the database.</p>
<p>For example, if a histogram with 20 bins is needed, and the variable has a minimum value of 1 and a maximum value of 101, then each bin needs to be 5.</p>
<ul>
<li>101 (Max value) - 1 (Min value) = 100</li>
<li>100 / 20 (Number of bins) = 5</li>
</ul>
<p>The first bin will have a range of 1 to 6, the second 7 to 12, etc.</p>
<p>After that, the count of values that are inside each range needs to be determined. In this example, there may be two rows that have a value between 1 and 6 and five rows with values between 7 and 12.</p>
<p>Any formula used to create a Histogram will need to calculate the bins, place the values inside the bins, and only call math functions supported by the database in use.</p>
</section>
<section id="using-a-helper-function" class="level3">
<h3 class="anchored" data-anchor-id="using-a-helper-function">Using a helper function</h3>
<p>An advantage of using <code>dplyr</code> to convert the continuous variable into a discrete variable is that one solution can be applied to multiple database types. This is possible if the resulting formula is made of basic functions that most SQL databases support and is expressed in R, so that <code>dplyr</code> can translate it into the proper SQL syntax.</p>
<p>Unfortunately, the formula is rather long and mistakes can be made if used in multiple locations, because any corrections to the formula may not be propagated to all of the instances. To solve this, a helper function can be used.</p>
<p>In the following helper function, the <code>var</code> input is used to build the formula in an <strong>unevaluated</strong> R code format. When used inside <code>dplyr</code>, it will return the assembled formula which will then be <strong>evaluated</strong> as inside the verb command. Feel free to copy this function into your script or R Notebook.</p>
<p>The function has two other arguments:</p>
<ul>
<li><code>bins</code> - this allows the number of bins to be customized. It defaults to 30</li>
<li><code>binwidth</code> - this is used to specify the size of the bin. It overrides any value passed to the <code>bins</code> argument.</li>
</ul>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-12_b5e5b0964b473820a4bcc137ded8298d">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>db_bin <span class="ot">&lt;-</span> <span class="cf">function</span>(var, <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">binwidth =</span> <span class="cn">NULL</span>) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">enexpr</span>(var)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  range <span class="ot">&lt;-</span> <span class="fu">expr</span>((<span class="fu">max</span>(<span class="sc">!!</span> var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(<span class="sc">!!</span> var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(binwidth)) {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    binwidth <span class="ot">&lt;-</span> <span class="fu">expr</span>((<span class="sc">!!</span> range <span class="sc">/</span> <span class="sc">!!</span> bins))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    bins <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">as.integer</span>(<span class="sc">!!</span> range <span class="sc">/</span> <span class="sc">!!</span> binwidth))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Made more sense to use floor() to determine the bin value than</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># using the bin number or the max or mean, feel free to customize</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  bin_number <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">as.integer</span>(<span class="fu">floor</span>((<span class="sc">!!</span> var <span class="sc">-</span> <span class="fu">min</span>(<span class="sc">!!</span> var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="sc">!!</span> binwidth)))</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Value(s) that match max(x) will be rebased to bin -1, giving us the exact number of bins requested</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expr</span>(((<span class="sc">!!</span> binwidth) <span class="sc">*</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(<span class="sc">!!</span> bin_number <span class="sc">==</span> <span class="sc">!!</span> bins, <span class="sc">!!</span> bin_number <span class="sc">-</span> <span class="dv">1</span>, <span class="sc">!!</span> bin_number)) <span class="sc">+</span> <span class="fu">min</span>(<span class="sc">!!</span> var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that the function returns a <strong>quosure</strong> containing the <strong>unevaluated</strong> R code that calculates the bins. To read more about how this kind of approach works, please refer to this article: <a href="http://dplyr.tidyverse.org/articles/programming.html">Programming with dplyr</a>.</p>
<p>It is important to note that the database in use needs to support the functions called in the formula, such as <code>min()</code> and <code>max()</code>.</p>
<p>Here is an example of the function’s output. Notice that a fictitious field called <code>any_field</code> is used, and no “missing field” error is generated. That is because the formula has not yet been evaluated.</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-14_3516e771ef7cbbf2e12297eaa9751f00">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">db_bin</span>(any_field)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is an example of the function using <code>binwidth</code>. The resulting formula is a little different.</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-16_c6c4fa32d9129ee2e6edf8600cfecbc1">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">db_bin</span>(any_field, <span class="at">binwidth =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-transformation-1" class="level3">
<h3 class="anchored" data-anchor-id="data-transformation-1">Data transformation</h3>
<p>The data processing is very simple when using the helper function. The <code>db_bin</code> function is used inside <code>group_by()</code>. There are a couple of <strong>must-do’s</strong> to keep in mind:</p>
<ul>
<li><p><strong>Specify the name of the field that uses the <code>db_bin()</code> function</strong> - If a name is not specified, <code>dplyr</code> will use the long formula text as the default name of the field, which in most cases breaks the database’s field name length rules.</p></li>
<li><p><strong>Prefix <code>!!</code> to the <code>db_bin()</code> function</strong> - This triggers the processing, or evaluation, of the function, which returns the complex formula.</p></li>
</ul>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-18_320c94a15f6037cee11a26828dc08bb8">
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"flights"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">x =</span> <span class="sc">!!</span> <span class="fu">db_bin</span>(sched_dep_time, <span class="at">bins =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-results-in-r-1" class="level3">
<h3 class="anchored" data-anchor-id="plotting-results-in-r-1">Plotting results in R</h3>
<p>Because the bins have been pre-processed on and collected from the database, the results are easily plotted using <code>geom_col()</code>. The resulting bin values are <code>x</code> and the count per bin is <code>y</code>:</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-20_1b4d1d2f7098f75497183640bcd73974">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transform-and-plot-1" class="level3">
<h3 class="anchored" data-anchor-id="transform-and-plot-1">Transform and plot</h3>
<p>Just like with the Bar plot, the entire process can be piped. Here is an example of using the <code>binwidth</code> argument instead of <code>bins</code>; additionally, the bin size is widened to 300-minute intervals:</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-22_5c6b24eda5b271ee2f586274d11b485a">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"flights"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">x =</span> <span class="sc">!!</span> <span class="fu">db_bin</span>(sched_dep_time, <span class="at">binwidth =</span> <span class="dv">300</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="raster-plot" class="level2">
<h2 class="anchored" data-anchor-id="raster-plot">Raster Plot</h2>
<p>To visualize two continuous variables, we typically resort to a <em>Scatter plot</em>. However, this may not be practical when visualizing millions or billions of dots representing the intersections of the two variables. A Raster plot may be a better option, because it concentrates the intersections into squares that are easier to parse visually.</p>
<p>A Raster plot basically does the same as a Histogram. It takes two continuous variables and creates discrete 2-dimensional bins represented as squares in the plot. It then determines either the number of rows inside each square or processes some aggregation, like an average.</p>
<section id="data-transformation-2" class="level3">
<h3 class="anchored" data-anchor-id="data-transformation-2">Data transformation</h3>
<p>The same helper function used to create the Histogram can be used to create the squares. The <code>db_bin()</code> function is used for each continuous variable inside <code>group_by()</code>, but in this case the number if <code>bins</code> is increased to 50:</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-24_3cdaf0773199a6601bb9e462e66caf2e">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"flights"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sc_dep_time =</span> <span class="sc">!!</span> <span class="fu">db_bin</span>(sched_dep_time, <span class="at">bins =</span> <span class="dv">50</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sc_arr_time =</span> <span class="sc">!!</span> <span class="fu">db_bin</span>(sched_arr_time, <span class="at">bins =</span> <span class="dv">50</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_distance =</span> <span class="fu">mean</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-results-in-r-2" class="level3">
<h3 class="anchored" data-anchor-id="plotting-results-in-r-2">Plotting results in R</h3>
<p>The plot can now be built using <code>geom_raster()</code>. Assigning <code>x</code> and <code>y</code> to each of the continuous variables will depend on what makes more sense for a given visualization. The result of each intersection is passed as the color of the square using <code>fill</code>.</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-26_bb83bc83949ce8dd2efa95bba6132088">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x =</span> sc_dep_time, <span class="at">y =</span> sc_arr_time, <span class="at">fill =</span> avg_distance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="considerations" class="level3">
<h3 class="anchored" data-anchor-id="considerations">Considerations</h3>
<p>There are two considerations when using a Raster plot with a database. Both considerations are related to the size of the results downloaded from the database:</p>
<ul>
<li><p>The number of <code>bins</code> requested: The higher the <code>bins</code> value is, the more data is downloaded from the database.</p></li>
<li><p>How concentrated the data is: This refers to how many intersections return a value. The more intersections without a value, the less data is downloaded from the database.</p></li>
</ul>
<p>In the previous example, there is a maximum of 2,500 rows (50 x 50). Because the data is highly concentrated, only 353 records are returned. This means that the data will be transmitted over the network quickly, but the trade-off is that the picture definition may not be ideal to gain insights about the data.</p>
<p>In the following example, the “definition” is set at 100 x 100. This improves the resolution but it quadruples the number of records that could potentially be downloaded.</p>
<div class="cell" data-layout.align="center" data-hash="visualization_cache/html/unnamed-chunk-28_dfe5c30ef05e2addfe1055b8242752b9">
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl</span>(con, <span class="st">"flights"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sc_dep_time =</span> <span class="sc">!!</span> <span class="fu">db_bin</span>(sched_dep_time, <span class="at">bins =</span> <span class="dv">100</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sc_arr_time =</span> <span class="sc">!!</span> <span class="fu">db_bin</span>(sched_arr_time, <span class="at">bins =</span> <span class="dv">100</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_distance =</span> <span class="fu">mean</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x =</span> sc_dep_time, <span class="at">y =</span> sc_arr_time, <span class="at">fill =</span> avg_distance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="use-an-r-package" class="level2">
<h2 class="anchored" data-anchor-id="use-an-r-package">Use an R package</h2>
<p>The <a href="../dbplot">dbplot</a> package provides helper functions that automate the aggregation and plotting steps. For more info, visit the <a href="../dbplot">dbplot article</a> in this website.</p>
<!-- -->
</section>
</main>
<div class="page-navigation page-navigation-docked">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->


</body></html>